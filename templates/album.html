<!DOCTYPE html>
<html>
<head>
    <title>{{ album['title'] }} - Details</title>
</head>
<body>
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <ul>
        {% for category, message in messages %}
            <li class="{{ category }}">{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}
    {% endwith %}

    <h1>{{ album['title'] }} by {{ album['artist'] }} ({{ album['year'] }}, {{ album['genre'] }})</h1>
    {% if album['image_url'] %}<img src="{{ album['image_url'] }}" alt="Album cover">{% endif %}
    <p>Average Rating: {% if avg_stars %}{{ '★' * (avg_stars | int) }}{{ '☆' * (5 - (avg_stars | int)) }}{% else %}No reviews yet{% endif %}</p>

    <h2>Reviews</h2>
    {% if reviews %}
    <ul>
        {% for review in reviews %}
        <li>
        <strong>{{ review['username'] }}</strong>: {{ '★' * review['stars'] }}{{ '☆' * (5 - review['stars']) }}<br>
        {{ review['text'] }}<br>
        <small>{{ review['created_at'] }}</small>
        </li>
        {% endfor %}
        </ul>
    {% else %}
        <p>No reviews yet.</p>
    {% endif %}

    {% if session.username and not has_reviewed %}
        <h2>Add Review</h2>
        <form action="/review/{{ album['id'] }}" method="POST">
            <label for="stars">Stars (1-5):</label>
            <select name="stars" id="stars">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select><br>
            <label for="text">Review Text:</label><br>
            <textarea name="text" id="text" rows="4" cols="50"></textarea><br>
            <input type="submit" value="Submit Review">
        </form>
    {% endif %}

    <a href="/">Back to Home</a>
</body>
</html>
