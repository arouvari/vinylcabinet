{% extends "base.html" %}

{% block content %}
<h1>Vinyl Cabinet</h1>

<form method="GET" action="{{ url_for('index') }}">
    <input type="text" name="query" value="{{ query }}" placeholder="Search albums by title, artist, year or genre...">
    <button type="submit">Search</button>
    {% if query %}
        <a href="{{ url_for('index') }}">Clear</a>
    {% endif %}
</form>

{% if albums %}
    <ul>
    {% for album in albums %}
        <li>
            <strong>{{ album['title'] }}</strong> by {{ album['artist'] }} ({{ album['year'] }})
            {% if album['genre'] %}
                - <em>{{ album['genre'] }}</em>
            {% endif %}
            <br>
            {% if album['image_url'] %}
                <img src="{{ album['image_url'] }}" alt="Album cover" width="100">
            {% else %}
                <img src="{{ url_for('static', filename='placeholder.jpg') }}" alt="Album cover" width="100">
            {% endif %}


            <br>
            <a href="{{ url_for('album_detail', album_id=album['id']) }}">View Details</a>

            {% if session.user_id %}
                {% if album.get('is_favorite') %}
                    <form action="{{ url_for('favorite', album_id=album['id']) }}" method="post" style="display:inline;">
                        <button type="submit">★ Unfavorite</button>
                    </form>
                {% else %}
                    <form action="{{ url_for('favorite', album_id=album['id']) }}" method="post" style="display:inline;">
                        <button type="submit">☆ Favorite</button>
                    </form>
                {% endif %}

                {% if album['user_id'] == session.user_id %}
                    <a href="{{ url_for('edit_album', album_id=album['id']) }}">Edit</a>
                    <form action="{{ url_for('delete_album', album_id=album['id']) }}" method="post" style="display:inline;">
                        <button type="submit" onclick="return confirm('Are you sure?')">Delete</button>
                    </form>
                {% endif %}
            {% endif %}

            {% if album.get('avg_stars') %}
                <br>Rating: {{ '★' * (album['avg_stars'] | int) }}{{ '☆' * (5 - (album['avg_stars'] | int)) }}
            {% endif %}
        </li>
    {% endfor %}
    </ul>
{% else %}
    <p>No albums found.</p>
{% endif %}

{% if session.username %}
    <p><a href="{{ url_for('add') }}">Add New Album</a></p>
    <p><a href="{{ url_for('user_page', username=session.username) }}">My Favorites</a></p>
{% endif %}
{% endblock %}